package com.announcify.api.contact;

import java.util.HashMap;
import java.util.Map;

import com.announcify.api.service.PluginService;
import com.announcify.api.util.PluginSettings;

import android.content.Context;

public class Formatter {
    // TODO: move to FormatEnum-Interface!
    public static final String EVENT = "<EVENT>";

    public static final String NAME = "<NAME>"; // as set per full-settings!
    
    public static final String UNKNOWN = "<UNKNOWN>";

    public static final String FULLNAME = "<FULLNAME>";

    public static final String FIRSTNAME = "<FIRSTNAME>";

    public static final String LASTNAME = "<LASTNAME>";

    public static final String NICKNAME = "<NICKNAME>";

    public static final String TITLE = "<TITLE>";

    public static final String ADDRESS = "<ADDRESS>";

    public static final String ADDRESS_TYPE = "<ADDRESSTYPE>";

    public static final String MESSAGE = "<MESSAGE>";


    private Map<String, ContactEnum> substitutes;
    
    private PluginSettings settings;

    private Context context;

    private Contact contact;

    private String text;


    public Formatter(Context context, Contact contact, PluginSettings settings) {
        this(new HashMap<String, ContactEnum>(), context, contact, settings);
        
        for (ContactEnum value : ContactEnum.values()) {
            addSubstitute(value);
        }
    }

    public Formatter(Map<String, ContactEnum> substitutes, Context context, Contact contact, PluginSettings settings) {
        this.substitutes = substitutes;
        this.settings = settings;
        this.context = context;
        this.contact = contact;

        if ("".equals(contact.getLookupString())) {
            // seems like we couldn't find the contact in the database! so, i assume he's unknown!
            text = settings.getUnknownMode();
            
            if ("".equals(text)) return;
            
            if (UNKNOWN.equals(text)) {
                
            }
        } else {
            
        }
        // TODO: get formatstring (default, unknown or discreet!)
    }


    public void addSubstitute(ContactEnum substitute) {
        substitutes.put(substitute.getExpression(), substitute);
    }

    public void format() {
        for (final String s : substitutes.keySet()) {
            // TODO: i don't want to pass context and contact here everytime! -> ContactEnum in Contact?
            text = text.replaceAll(s, substitutes.get(s).getSubstitution(context, contact));
        }
    }
}