package com.announcify.contact;

import java.util.List;

import android.content.Context;
import android.content.res.Resources;

import com.announcify.util.HeadsetFinder;
import com.announcify.util.PluginSettings;

public class Prepare {
	private PluginSettings settings;
	private Context context;
	private Contact contact;

	private String reading;

	public Prepare(Context context, PluginSettings settings, Contact contact) {
		this.settings = settings;
		this.context = context;
		this.contact = contact;

		if (!prepareName()) return; 
		prepareDiscreet();
	}

	public String getName() {
		return reading;
	}

	public void getQueue(List<Object> list) {
		list.add(settings.getReadingWait());
		for (int i = 0; i < settings.getReadingRepeat(); i++) {
			list.add(reading);
			list.add(new Integer(settings.getReadingBreak()));
		}
	}

	private boolean prepareName() {
		String temp = contact.getUserPreferredName();
		if ("".equals(temp)) {
			switch (settings.getUnknownMode()) {
			case 0:
				// user requested not to speak if unknown
				reading = "";
				return false;

			case 1:
				// TODO
				reading = "Unknown";
				break;

			case 2:
				reading = settings.getAnnouncement();
				return false;

			case 3:
				reading = "You have a new Announcification!";
				return false;

			case 4:
				reading = settings.getCustomAnnouncement();

			default:
				reading = "";
				return false;
			}
		} else {
			reading = temp;
		}

		return true;
	}

	private void prepareDiscreet() {
		if (HeadsetFinder.isDiscreet(context)) {
			prepareDiscreetReading();
		} else {
			prepareReading();
		}
	}

	private void prepareReading() {
		switch (settings.getAnnouncementMode()) {
		case 0:
			break;

		case 1:
			reading += " from " + ""; // TODO: add address type
			break;

		case 2:
			reading = "Message from " + reading;
			break;

		case 3:
			reading = "Message from " + reading + ": "; // TODO: add message
			break;

		case 4:
			reading = settings.getAnnouncement();
			break;

		case 5:
			reading = "You have a new Announcification!";
			break;

		case 6:
			reading = settings.getCustomAnnouncement();
			break;

		default:
			reading = "";
			break;
		}
	}

	private void prepareDiscreetReading() {
		switch (settings.getDiscreetMode()) {
		case 0:
			prepareReading();

		default:
			reading = "";
		}
	}
	
	private String getUnknownString() {
        return Resources.getSystem().getString(android.R.string.unknownName);
//        UNKNOWN = UNKNOWN.substring(1, UNKNOWN.length() - 1);
	}
}