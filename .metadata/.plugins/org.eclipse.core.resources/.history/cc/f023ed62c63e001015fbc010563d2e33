package com.announcify.api.background.util;

import android.content.Context;
import android.content.SharedPreferences;


public abstract class PluginSettings {

    public static final String DEFAULT_SETTING = "com.announcify.DEFAULT";
    
    public static final String KEY_RINGTONE = "preference_ringtone";
    public static final String KEY_READING_BREAK = "preference_reading_break";
    public static final String KEY_READING_REPEAT = "preference_reading_repeat";
    public static final String KEY_READING_WAIT = "preference_reading_wait";
    public static final String KEY_READING_UNKNOWN = "preference_reading_unknown";
    public static final String KEY_READING_UNKNOWN_CUSTOM = "preference_reading_unknown_custom";
    public static final String KEY_READING_DISCREET = "preference_reading_discreet";
    public static final String KEY_READING_DISCREET_CUSTOM = "preference_reading_discreet_custom";
    public static final String KEY_READING_ANNOUNCEMENT = "preference_reading_announcement";
    public static final String KEY_READING_ANNOUNCEMENT_CUSTOM = "preference_reading_announcement_custom";

    protected final String name;
    protected final Context context;
    protected final SharedPreferences preferences;
    protected final AnnouncifySettings defaultSettings;

    public PluginSettings(final Context context, final String name) {
        preferences = context.getSharedPreferences(name, Context.MODE_WORLD_READABLE);
        defaultSettings = new AnnouncifySettings(context);
        this.context = context;
        this.name = name;
    }

    public String getDefaultMode() {
        final String s = preferences.getString(KEY_READING_ANNOUNCEMENT, DEFAULT_SETTING);
        if (s.equals(DEFAULT_SETTING)) {
            return defaultSettings.getDefaultDefaultMode();
        } else {
            return s;
        }
    }

    public String getDiscreetMode() {
        final String s = preferences.getString(KEY_READING_DISCREET, defaultSettings.getDefaultDiscreetMode());
        if (s.equals(DEFAULT_SETTING)) {
            return defaultSettings.getDefaultDiscreetMode();
        } else {
            return s;
        }
    }

    public abstract String getEventType();

    public abstract int getPriority();

    public int getReadingBreak() {
        int i;
        
        final String s = preferences.getString(KEY_READING_BREAK, String.valueOf(defaultSettings.getDefaultReadingBreak()));
        if (s.equals(DEFAULT_SETTING)) {
            i = defaultSettings.getDefaultReadingBreak();
        }
        
        i = Integer.parseInt(s);
        
        if (i == 0) return 0;

        return i < 1000 ? i * 1000 : i;
    }

    public int getReadingRepeat() {
        return Integer.parseInt(preferences.getString(KEY_READING_REPEAT, String.valueOf(defaultSettings.getDefaultReadingRepeat())));
    }

    public int getReadingWait() {
        final int i = Integer.parseInt(preferences.getString(KEY_READING_WAIT, String.valueOf(defaultSettings.getDefaultReadingWait())));

        if (i == 0) return 0;

        return i < 1000 ? i * 1000 : i;
    }

    public abstract String getSettingsAction();

    public String getSharedPreferencesName() {
        return name;
    }

    public String getUnknownMode() {
        return preferences.getString(KEY_READING_UNKNOWN, defaultSettings.getDefaultUnknownMode());
    }
    
    public String getRingtone() {
        return preferences.getString(KEY_RINGTONE, defaultSettings.getRingtone());
    }
}
