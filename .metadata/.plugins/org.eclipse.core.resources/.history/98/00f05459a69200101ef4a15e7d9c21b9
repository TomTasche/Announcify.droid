<!DOCTYPE HTML>
<html>
	<head>
		<title>Announcify for Google Chrome</title>
		
		<script type="text/javascript" src="announcify_credential.js"></script>
		<script type="text/javascript" src="announcify_gmail.js"></script>
		<script type="text/javascript" src="channel.js"></script>
		<script type="text/javascript">
		
			function onRequest(request, sender, callback) {
				saveToken(request);
				
				checkMails();
      		}
      		
      		function login() {
      			if (!isTokenAvailable("appengine")) {
      				chrome.tabs.create({url: "https://announcify.appspot.com/appengine/login"});
      			} else if (!isTokenAvailable("gmail")) {
      				chrome.tabs.create({url: "https://announcify.appspot.com/gmail/login"});
      			} else {
      				return true;
      			}
      			
      			return false;
      		}
			
			chrome.extension.onRequest.addListener(onRequest);
			
			chrome.browserAction.onClicked.addListener(function (tab) {
				if (login()) {
      				// checkMails();
      				
      				
      			}
			});
      		
      		// setInterval(checkMails, 600000);
		</script>
	</head>
	
<!--	<body onload="checkMails();">-->
	<body>
		<audio id="speech" controls="controls" autoplay="autoplay">Your browser does not support the audio element.</audio>
	</body>
</html>
