<!DOCTYPE HTML>
<html>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.js"></script>
		
		<script>
			function getURLParam(key) {
				var result = "";
				var url = window.location.href;
				
				if (url.indexOf("?") > -1) {
					var query = url.substr(url.indexOf("?")).toLowerCase();
					
					var parameters = query.split("&");
					
					for (var i = 0; i < parameters.length; i++) {
						if (parameters[i].indexOf(key + "=") > -1) {
							var aParam = parameters[i].split("=");
							
							result = aParam[1];
							
							break;
						}
					}
				}
				
				return result;
			}
			
			function announcify(text) {
				var speech = document.getElementById("speech");
				speech.setAttribute("src", "http://translate.google.com/translate_tts?tl=en&q=" + encodeURIComponent(text));
			}
			
			function checkMails() {
				$.getJSON("http://localhost:8888/gmail", function(data) {
					alert(data[0].fullcount);
					if (data[0].fullcount <= 0) {
						return;
					}
						
					announcify(data[0].fullcount + " new mails!");
					alert(data[0].fullcount + " new mails!");
				});
			}
			
			// setInterval("checkMails()", 10000);
		</script>
	</head>
	
	<body onload="checkMails();">
		<audio id="speech" controls="controls" autoplay="autoplay">Your browser does not support the audio element.</audio>
		
		<div onclick="checkMails();" style="background-color: red; width: 50px; height: 50px;"></div>
	</body>
</html>
