
package com.announcify.api.background.service;

import com.announcify.api.background.sql.model.BaseModel;
import com.announcify.api.background.sql.model.PluginModel;
import com.announcify.api.background.util.PluginSettings;
import com.announcify.plugin.voice.call.activity.SettingsActivity;
import com.announcify.plugin.voice.call.util.Settings;

import android.app.IntentService;
import android.content.ContentValues;
import android.content.Intent;

public abstract class PluginService extends IntentService {
    public static final String ACTION_PLUGIN_CONTACT = "com.announcify.ACTION_PLUGIN_CONTACT";

    public static final String ACTION_ANNOUNCE = "com.announcify.ANNOUNCE";

    public static final String EXTRA_PRIORITY = "com.announcify.EXTRA_PRIORITY";

    public static final String EXTRA_QUEUE = "com.announcify.EXTRA_QUEUE";

    public static final String EXTRA_PLUGIN_NAME = "com.announcify.EXTRA_PLUGIN_NAME";

    public static final String EXTRA_PLUGIN_PACKAGE = "com.announcify.EXTRA_PLUGIN_PACKAGE";

    public static final String EXTRA_PLUGIN_ACTION = "com.announcify.EXTRA_PLUGIN_ACTION";

    public static final String EXTRA_PLUGIN_BROADCAST = "com.announcify.EXTRA_PLUGIN_BROADCAST";

    public static final String EXTRA_PLUGIN_PRIORITY = "com.announcify.EXTRA_PLUGIN_PRIORITY";

    protected PluginSettings settings;

    public PluginService(final String name, PluginSettings settings) {
        super(name);

        this.settings = settings;
    }

    @Override
    protected void onHandleIntent(final Intent intent) {
        if (ACTION_PLUGIN_CONTACT.equals(intent.getAction())) {
            final PluginModel model = new PluginModel(this);

            final long id = model.getId(settings.getEventType());
            if (id < 0) {
                model.add(settings.getEventType(), settings.getPriority(), settings.getSettingsAction(), getPackageName(), false);
            } else {
                model.update(id, settings.getEventType(), settings.getPriority(), settings.getSettingsAction(), getPackageName(), false);
            }
        }
    }
}
